#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

BRANCH=$(git rev-parse --abbrev-ref HEAD)

ALLOWED_PREFIXES="^(feature|fix|refactor|chore)/[a-z0-9._-]+$"

if [ "$BRANCH" = "main" ] || [ "$BRANCH" = "develop" ]; then
  echo "ğŸ” Skipping branch name check for \"$BRANCH\"."
else
  if echo "$BRANCH" | grep -Eq "$ALLOWED_PREFIXES"; then
    echo "âœ… Branch name \"$BRANCH\" is valid."
  else
    echo "âŒ Invalid branch name: \"$BRANCH\""
    echo "âš ï¸  Use format: feature/xxx, fix/xxx, refactor/xxx, chore/xxx"
    exit 1
  fi
fi

echo "ğŸ” Running lint-staged..."
npx lint-staged || exit 1

echo "ğŸ›  Running build..."
yarn build || exit 1
